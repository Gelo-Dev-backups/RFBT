<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RFBT Ultimate Quiz</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            min-height: 100vh; 
            display: flex; 
            flex-direction: column; 
            transition: background-color 0.3s, color 0.3s;
        }

        /* CARD STYLING */
        .card { 
            border: none; 
            border-radius: 15px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.08); 
            transition: 0.3s;
        }

        /* OPTION BUTTONS */
        .btn-option { 
            text-align: left; 
            border: 2px solid #e9ecef; 
            margin-bottom: 12px; 
            padding: 15px; 
            border-radius: 10px; 
            font-weight: 500; 
            width: 100%;
            background: transparent;
            color: inherit;
            transition: all 0.2s;
            position: relative;
        }
        .btn-option:hover { 
            background-color: #f8f9fa; 
            border-color: #dee2e6;
            transform: translateX(5px); 
        }
        
        /* CHECKED STATE */
        .btn-check:checked + .btn-option { 
            background-color: #0d6efd; 
            color: white; 
            border-color: #0d6efd; 
            box-shadow: 0 5px 15px rgba(13, 110, 253, 0.3); 
        }

        /* REVIEW SECTION */
        .review-card { 
            border-left: 8px solid #ccc; 
            margin-bottom: 1.5rem; 
        }
        .review-correct { 
            border-left-color: #198754; 
            background-color: rgba(25, 135, 84, 0.05); 
        }
        .review-wrong { 
            border-left-color: #dc3545; 
            background-color: rgba(220, 53, 69, 0.05); 
        }

        .hidden { display: none !important; }

        /* --- DARK MODE OVERRIDES --- */
        [data-bs-theme="dark"] body { background-color: #121212; color: #e0e0e0; }
        [data-bs-theme="dark"] .card { background-color: #1e1e1e; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        [data-bs-theme="dark"] .btn-option { border-color: #333; color: #e0e0e0; }
        [data-bs-theme="dark"] .btn-option:hover { background-color: #2a2a2a; border-color: #444; }
        [data-bs-theme="dark"] .btn-check:checked + .btn-option { background-color: #0d6efd; border-color: #0d6efd; color: white; }
        
        /* Dark Mode Review Section */
        [data-bs-theme="dark"] .review-correct { background-color: rgba(25, 135, 84, 0.15); }
        [data-bs-theme="dark"] .review-wrong { background-color: rgba(220, 53, 69, 0.15); }
        [data-bs-theme="dark"] .form-control { background-color: #2b2b2b; border-color: #444; color: white; }
        [data-bs-theme="dark"] .form-control:focus { background-color: #333; color: white; }
    </style>
</head>
<body class="bg-light">

    <nav class="navbar navbar-expand-lg border-bottom sticky-top" style="backdrop-filter: blur(10px); background-color: rgba(255,255,255,0.8);">
        <div class="container">
            <span class="navbar-brand fw-bold fs-4"><i class="fas fa-book-open text-primary me-2"></i>RFBT Master</span>
            
            <div class="d-flex align-items-center gap-3">
                <div class="text-end d-none d-sm-block lh-1">
                    <div id="clock-time" class="fw-bold fs-5">00:00:00</div>
                    <div id="clock-date" class="small text-muted text-uppercase" style="font-size: 0.75rem;">Loading Date...</div>
                </div>
                
                <button class="btn btn-outline-secondary rounded-circle" id="themeToggle" style="width: 40px; height: 40px;">
                    <i class="fas fa-moon"></i>
                </button>
            </div>
        </div>
    </nav>

    <main class="container my-5 flex-grow-1">
        
        <div id="setup-view" class="row justify-content-center">
            <div class="col-md-6">
                <div class="card p-4 p-md-5">
                    <h2 class="fw-bold text-center mb-4">Quiz Configuration</h2>
                    <form id="setup-form">
                        <div class="mb-4">
                            <label class="fw-bold small text-muted text-uppercase mb-2">Question Type</label>
                            <select class="form-select form-select-lg" id="qType">
                                <option value="mixed">Mixed (Random)</option>
                                <option value="multiple_choice">Multiple Choice</option>
                                <option value="situational">Situational</option>
                                <option value="identification">Identification</option>
                            </select>
                        </div>
                        <div class="mb-4">
                            <label class="fw-bold small text-muted text-uppercase mb-2">Number of Questions</label>
                            <div class="btn-group w-100" role="group">
                                <input type="radio" class="btn-check" name="qCount" id="c10" value="10" checked>
                                <label class="btn btn-outline-primary" for="c10">10</label>
                                <input type="radio" class="btn-check" name="qCount" id="c20" value="20">
                                <label class="btn btn-outline-primary" for="c20">20</label>
                                <input type="radio" class="btn-check" name="qCount" id="c30" value="30">
                                <label class="btn btn-outline-primary" for="c30">30</label>
                                <input type="radio" class="btn-check" name="qCount" id="c60" value="60">
                                <label class="btn btn-outline-primary" for="c60">60</label>
                            </div>
                        </div>
                        <div class="mb-4">
                            <label class="fw-bold small text-muted text-uppercase mb-2">Article Range (1767 - 1809)</label>
                            <div class="input-group input-group-lg">
                                <span class="input-group-text">Start</span>
                                <input type="number" class="form-control" id="startArt" value="1767" min="1767" max="1809">
                                <span class="input-group-text">End</span>
                                <input type="number" class="form-control" id="endArt" value="1809" min="1767" max="1809">
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary w-100 btn-lg fw-bold shadow-sm py-3">
                            Start Quiz <i class="fas fa-arrow-right ms-2"></i>
                        </button>
                        <div id="error-box" class="alert alert-danger mt-3 hidden small text-center fw-bold"></div>
                    </form>
                </div>
            </div>
        </div>

        <div id="quiz-view" class="row justify-content-center hidden">
            <div class="col-md-8">
                <div class="d-flex justify-content-between mb-2 small fw-bold text-muted text-uppercase">
                    <span>Question <span id="curr-num">1</span> of <span id="total-num">10</span></span>
                    <span id="art-ref" class="badge bg-secondary">Art. 0000</span>
                </div>
                <div class="progress mb-4" style="height: 8px;"><div class="progress-bar bg-primary" id="progress-bar" style="width: 0%"></div></div>
                
                <div class="card p-4 p-md-5 mb-4">
                    <span class="badge bg-opacity-10 text-primary border border-primary w-auto align-self-start mb-3 px-3 py-2" id="type-badge" style="background-color: rgba(13, 110, 253, 0.1);">TYPE</span>
                    <h4 class="fw-bold mb-4 lh-base" id="q-text" style="font-size: 1.35rem;">Question Text...</h4>
                    
                    <div id="options-area" class="d-flex flex-column"></div>
                </div>

                <div class="d-flex justify-content-between align-items-center">
                    <button class="btn btn-outline-danger px-4" onclick="confirmQuit()">
                        <i class="fas fa-times me-2"></i>Quit
                    </button>
                    <button class="btn btn-primary btn-lg px-5 fw-bold shadow-sm" onclick="handleNext()">
                        Next <i class="fas fa-arrow-right ms-2"></i>
                    </button>
                </div>
            </div>
        </div>

        <div id="result-view" class="row justify-content-center hidden">
            <div class="col-md-8 text-center">
                <div class="card p-5 mb-4">
                    <div class="mb-4">
                        <i class="fas fa-trophy text-warning fa-5x drop-shadow"></i>
                    </div>
                    <h2 class="fw-bold mb-2">Quiz Completed!</h2>
                    <p class="text-muted">Here is your final result</p>
                    
                    <div class="display-2 fw-bold text-primary my-3">
                        <span id="final-score">0</span>
                        <span class="text-muted fs-3"> / <span id="final-total">0</span></span>
                    </div>
                    
                    <div id="feedback-msg" class="alert alert-light border fw-bold mb-4"></div>
                    
                    <div class="d-grid gap-3 d-sm-flex justify-content-center">
                        <button class="btn btn-warning btn-lg px-4 fw-bold text-dark shadow-sm" onclick="toggleReviewSection()">
                            <i class="fas fa-eye me-2"></i> VIEW ANSWERS
                        </button>
                        <button class="btn btn-dark btn-lg px-4 fw-bold shadow-sm" onclick="resetQuiz()">
                            <i class="fas fa-redo-alt me-2"></i> Play Again
                        </button>
                    </div>
                </div>

                <div id="review-container" class="text-start hidden">
                    <div class="card p-4">
                        <div class="d-flex justify-content-between align-items-center mb-4 border-bottom pb-3">
                            <h4 class="fw-bold m-0"><i class="fas fa-list-check text-primary me-2"></i>Answer Key</h4>
                            <button class="btn btn-sm btn-outline-secondary" onclick="window.scrollTo(0,0)">Top</button>
                        </div>
                        <div id="review-list"></div> 
                    </div>
                </div>
            </div>
        </div>

    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        const quizData = [
  {
    "id": 1,
    "type": "multiple_choice",
    "article": 1767,
    "question": "Which of the following is NOT a requisite for a valid contract of partnership?",
    "options": [
      "Mutual contribution to a common fund",
      "Lawful object or purpose",
      "Intention to divide profits",
      "Capital of at least P3,000"
    ],
    "answer": "Capital of at least P3,000"
  },
  {
    "id": 2,
    "type": "multiple_choice",
    "article": 1767,
    "question": "A partnership formed for the exercise of a profession (like a law firm) is valid. Which Article recognizes this?",
    "options": [
      "Article 1767",
      "Article 1770",
      "Article 1780",
      "Article 1800"
    ],
    "answer": "Article 1767"
  },
  {
    "id": 3,
    "type": "multiple_choice",
    "article": 1768,
    "question": "Does a partnership need to comply with SEC registration to have a juridical personality?",
    "options": [
      "Yes, always.",
      "No, it has personality even without registration.",
      "Yes, if the capital exceeds P3,000.",
      "No, unless it is a limited partnership."
    ],
    "answer": "No, it has personality even without registration."
  },
  {
    "id": 4,
    "type": "multiple_choice",
    "article": 1769,
    "question": "Which of the following is prima facie evidence that a person is a partner in a business?",
    "options": [
      "Sharing of gross returns",
      "Co-ownership of property",
      "Sharing of profits",
      "Receiving wages"
    ],
    "answer": "Sharing of profits"
  },
  {
    "id": 5,
    "type": "multiple_choice",
    "article": 1770,
    "question": "If a partnership is dissolved because its purpose was illegal (e.g., gambling), what happens to the profits?",
    "options": [
      "Returned to partners",
      "Confiscated by the State",
      "Donated to charity",
      "Kept by the managing partner"
    ],
    "answer": "Confiscated by the State"
  },
  {
    "id": 6,
    "type": "multiple_choice",
    "article": 1771,
    "question": "A partnership agreement can be oral, EXCEPT when:",
    "options": [
      "Capital is more than P3,000",
      "Immovable property is contributed",
      "It is a general partnership",
      "It is for a fixed term"
    ],
    "answer": "Immovable property is contributed"
  },
  {
    "id": 7,
    "type": "multiple_choice",
    "article": 1773,
    "question": "If real property is contributed but no inventory is attached to the public instrument, the partnership contract is:",
    "options": [
      "Voidable",
      "Rescissible",
      "Void",
      "Unenforceable"
    ],
    "answer": "Void"
  },
  {
    "id": 8,
    "type": "multiple_choice",
    "article": 1776,
    "question": "As to its object, a partnership is either:",
    "options": [
      "General or Limited",
      "Universal or Particular",
      "De Jure or De Facto",
      "Fixed Term or At Will"
    ],
    "answer": "Universal or Particular"
  },
  {
    "id": 9,
    "type": "multiple_choice",
    "article": 1777,
    "question": "A Universal Partnership may refer to:",
    "options": [
      "All present property or all profits",
      "All future property only",
      "Only movable property",
      "Only immovable property"
    ],
    "answer": "All present property or all profits"
  },
  {
    "id": 10,
    "type": "multiple_choice",
    "article": 1785,
    "question": "A partnership that continues business after its fixed term has expired is called:",
    "options": [
      "Partnership by Estoppel",
      "Partnership at Will",
      "Limited Partnership",
      "De Facto Partnership"
    ],
    "answer": "Partnership at Will"
  },
  {
    "id": 11,
    "type": "multiple_choice",
    "article": 1786,
    "question": "When must a partner deliver his contribution to the partnership?",
    "options": [
      "Upon demand",
      "Within 30 days",
      "At the start of the partnership execution",
      "When the business registers"
    ],
    "answer": "At the start of the partnership execution"
  },
  {
    "id": 12,
    "type": "multiple_choice",
    "article": 1788,
    "question": "A partner who fails to contribute promised money on time becomes a debtor for:",
    "options": [
      "Interest and damages",
      "The principal only",
      "Penalty fees only",
      "Nothing"
    ],
    "answer": "Interest and damages"
  },
  {
    "id": 13,
    "type": "multiple_choice",
    "article": 1789,
    "question": "Which partner is prohibited from engaging in ANY business for himself?",
    "options": [
      "Capitalist Partner",
      "Industrial Partner",
      "Managing Partner",
      "Silent Partner"
    ],
    "answer": "Industrial Partner"
  },
  {
    "id": 14,
    "type": "multiple_choice",
    "article": 1791,
    "question": "In case of imminent loss, a capitalist partner who refuses to contribute additional share must:",
    "options": [
      "Be imprisoned",
      "Sell his interest to the other partners",
      "Pay double the contribution",
      "Resign as manager"
    ],
    "answer": "Sell his interest to the other partners"
  },
  {
    "id": 15,
    "type": "multiple_choice",
    "article": 1794,
    "question": "Every partner is responsible to the partnership for damages suffered by it through his:",
    "options": [
      "Luck",
      "Fault",
      "Absence",
      "Illness"
    ],
    "answer": "Fault"
  },
  {
    "id": 16,
    "type": "multiple_choice",
    "article": 1796,
    "question": "The partnership is responsible to every partner for amounts he may have disbursed on behalf of the partnership. This is called:",
    "options": [
      "Compensation",
      "Reimbursement",
      "Remuneration",
      "Dividends"
    ],
    "answer": "Reimbursement"
  },
  {
    "id": 17,
    "type": "multiple_choice",
    "article": 1797,
    "question": "If there is no agreement on profit sharing, how is it distributed?",
    "options": [
      "Equally",
      "In proportion to capital contribution",
      "By seniority",
      "Decided by the manager"
    ],
    "answer": "In proportion to capital contribution"
  },
  {
    "id": 18,
    "type": "multiple_choice",
    "article": 1799,
    "question": "Is a stipulation excluding a partner from any share in profits valid?",
    "options": [
      "Yes",
      "No, it is void",
      "Yes, if in writing",
      "Yes, for limited partners"
    ],
    "answer": "No, it is void"
  },
  {
    "id": 19,
    "type": "multiple_choice",
    "article": 1800,
    "question": "A managing partner appointed in the Articles of Partnership can only be removed for:",
    "options": [
      "Loss of confidence",
      "Just or lawful cause",
      "Majority vote",
      "Any reason"
    ],
    "answer": "Just or lawful cause"
  },
  {
    "id": 20,
    "type": "multiple_choice",
    "article": 1801,
    "question": "If two managers disagree, whose decision prevails?",
    "options": [
      "The older one",
      "The one with more capital",
      "The majority of the managers",
      "The court"
    ],
    "answer": "The majority of the managers"
  },
  {
    "id": 21,
    "type": "multiple_choice",
    "article": 1803,
    "question": "If no management rule is agreed upon, who are agents of the partnership?",
    "options": [
      "Only the capitalist partners",
      "All partners",
      "Only the industrial partners",
      "No one"
    ],
    "answer": "All partners"
  },
  {
    "id": 22,
    "type": "multiple_choice",
    "article": 1804,
    "question": "Can a partner associate a third person with his share?",
    "options": [
      "Yes, always",
      "No, never",
      "Yes, but the associate does not become a partner without consent",
      "Yes, and the associate automatically becomes a partner"
    ],
    "answer": "Yes, but the associate does not become a partner without consent"
  },
  {
    "id": 23,
    "type": "multiple_choice",
    "article": 1805,
    "question": "Partnership books shall be kept at:",
    "options": [
      "The SEC office",
      "The principal place of business",
      "The manager's home",
      "The bank"
    ],
    "answer": "The principal place of business"
  },
  {
    "id": 24,
    "type": "multiple_choice",
    "article": 1806,
    "question": "Partners must render on demand true and full information to:",
    "options": [
      "The public",
      "Any partner or legal representative",
      "The police",
      "Competitors"
    ],
    "answer": "Any partner or legal representative"
  },
  {
    "id": 25,
    "type": "multiple_choice",
    "article": 1807,
    "question": "A partner who derives profit from a partnership transaction without consent holds that profit as:",
    "options": [
      "Owner",
      "Trustee",
      "Debtor",
      "Creditor"
    ],
    "answer": "Trustee"
  },
  {
    "id": 26,
    "type": "multiple_choice",
    "article": 1808,
    "question": "Can a capitalist partner engage in a business similar to the partnership?",
    "options": [
      "Yes, always",
      "No, unless stipulated otherwise",
      "Yes, if he pays tax",
      "No, never"
    ],
    "answer": "No, unless stipulated otherwise"
  },
  {
    "id": 27,
    "type": "multiple_choice",
    "article": 1809,
    "question": "When can a partner demand a formal account of partnership affairs?",
    "options": [
      "Every day",
      "Only upon dissolution",
      "If wrongfully excluded from business",
      "When the moon is full"
    ],
    "answer": "If wrongfully excluded from business"
  },
  {
    "id": 28,
    "type": "multiple_choice",
    "article": 1772,
    "question": "Failure to register a partnership with P3,000 capital affects:",
    "options": [
      "Its juridical personality",
      "Its validity",
      "Liability to third parties",
      "Nothing"
    ],
    "answer": "Liability to third parties"
  },
  {
    "id": 29,
    "type": "multiple_choice",
    "article": 1784,
    "question": "A partnership begins from:",
    "options": [
      "The moment of execution of the contract",
      "Registration with SEC",
      "The first sale",
      "The first meeting"
    ],
    "answer": "The moment of execution of the contract"
  },
  {
    "id": 30,
    "type": "multiple_choice",
    "article": 1793,
    "question": "If a partner receives his share of a partnership credit and the debtor becomes insolvent, must he bring his share to the partnership capital?",
    "options": [
      "No, it's his luck",
      "Yes, even if he gave a receipt for his share only",
      "Only if the amount is large",
      "No, finders keepers"
    ],
    "answer": "Yes, even if he gave a receipt for his share only"
  },
  {
    "id": 31,
    "type": "situational",
    "article": 1767,
    "question": "A and B agree to contribute money to buy a lottery ticket, promising to divide the prize if they win. Is this a partnership?",
    "options": [
      "Yes, because there is contribution and intent to share profits.",
      "No, because it is not a business or trade.",
      "Yes, it is a particular partnership.",
      "No, because gambling is illegal."
    ],
    "answer": "Yes, because there is contribution and intent to share profits."
  },
  {
    "id": 32,
    "type": "situational",
    "article": 1769,
    "question": "X receives 10% of the net income of a bakery as payment for a loan he gave the owner. Is X a partner?",
    "options": [
      "Yes, sharing profits is prima facie evidence.",
      "No, because the money is received as payment for a debt.",
      "Yes, because he has financial interest.",
      "Maybe, if he attends meetings."
    ],
    "answer": "No, because the money is received as payment for a debt."
  },
  {
    "id": 33,
    "type": "situational",
    "article": 1773,
    "question": "Partners A and B contribute land to their partnership. They sign a private document but do not attach an inventory. Is the partnership valid?",
    "options": [
      "Yes, as between them.",
      "No, the contract is void entirely.",
      "Yes, but they cannot sell the land.",
      "No, unless they pay a fine."
    ],
    "answer": "No, the contract is void entirely."
  },
  {
    "id": 34,
    "type": "situational",
    "article": 1782,
    "question": "Husband and wife want to form a Universal Partnership of Profits. Is this allowed?",
    "options": [
      "No, spouses cannot form universal partnerships.",
      "Yes, spouses can form a universal partnership of profits.",
      "No, only particular partnerships are allowed.",
      "Yes, if they have separate property regimes."
    ],
    "answer": "No, spouses cannot form universal partnerships."
  },
  {
    "id": 35,
    "type": "situational",
    "article": 1785,
    "question": "A partnership for a fixed term of 5 years expires. The partners continue business without a new contract. What kind of partnership is it now?",
    "options": [
      "Partnership by Estoppel",
      "De Facto Partnership",
      "Partnership at Will",
      "Illegal Partnership"
    ],
    "answer": "Partnership at Will"
  },
  {
    "id": 36,
    "type": "situational",
    "article": 1786,
    "question": "Partner A promised to contribute a car on Jan 1. He delivered it on Jan 15. The car's value dropped by P5,000 during that delay. What is A liable for?",
    "options": [
      "Nothing, he delivered it.",
      "Interest and damages for the delay.",
      "He must buy a new car.",
      "He is expelled."
    ],
    "answer": "Interest and damages for the delay."
  },
  {
    "id": 37,
    "type": "situational",
    "article": 1789,
    "question": "A is an industrial partner in a printing business. He opens a coffee shop on weekends. The partners did not give permission. Can they expel him?",
    "options": [
      "No, coffee is different from printing.",
      "Yes, industrial partners cannot engage in ANY business for themselves.",
      "No, because it's only on weekends.",
      "Yes, but they must pay him back."
    ],
    "answer": "Yes, industrial partners cannot engage in ANY business for themselves."
  },
  {
    "id": 38,
    "type": "situational",
    "article": 1791,
    "question": "The partnership is losing money fast. The partners vote to contribute P50,000 each to save it. Partner B (Capitalist) refuses because he wants to save his own money. What happens?",
    "options": [
      "He can keep his money.",
      "He must sell his interest to the others.",
      "The partnership is dissolved.",
      "He becomes a limited partner."
    ],
    "answer": "He must sell his interest to the others."
  },
  {
    "id": 39,
    "type": "situational",
    "article": 1792,
    "question": "Partner M (Manager) collects P5,000 from Debtor D. D owes the Partnership P10,000 and M P10,000. M gives a receipt for his own credit. How is the P5,000 applied?",
    "options": [
      "All to M.",
      "All to Partnership.",
      "Proportionately (P2,500 each).",
      "Whatever D decides."
    ],
    "answer": "Proportionately (P2,500 each)."
  },
  {
    "id": 40,
    "type": "situational",
    "article": 1794,
    "question": "Partner X caused P10,000 damage to the firm by negligence. But last year, he made P50,000 profit for the firm. Can he say 'Keep the P10,000 from my past profits'?",
    "options": [
      "Yes, it's fair.",
      "No, damages cannot be compensated by industry profits.",
      "Yes, if the manager agrees.",
      "No, unless the court says so."
    ],
    "answer": "No, damages cannot be compensated by industry profits."
  },
  {
    "id": 41,
    "type": "situational",
    "article": 1795,
    "question": "Partner G contributes the USE of his van. A typhoon destroys the van. Who loses the van?",
    "options": [
      "The Partnership.",
      "Partner G.",
      "All partners equally.",
      "The insurance only."
    ],
    "answer": "Partner G."
  },
  {
    "id": 42,
    "type": "situational",
    "article": 1795,
    "question": "Partner H contributes 100 sacks of corn (fungible). They are destroyed by fire. Who bears the loss?",
    "options": [
      "Partner H.",
      "The Partnership.",
      "The customer.",
      "No one."
    ],
    "answer": "The Partnership."
  },
  {
    "id": 43,
    "type": "situational",
    "article": 1797,
    "question": "A (Capital P100k) and B (Capital P50k) have no profit agreement. They earn P30k. How much does B get?",
    "options": [
      "P15,000",
      "P10,000",
      "P20,000",
      "P5,000"
    ],
    "answer": "P10,000"
  },
  {
    "id": 44,
    "type": "situational",
    "article": 1797,
    "question": "C is an industrial partner. The partnership loses P100,000. How much does C pay?",
    "options": [
      "Equal share",
      "Proportionate share",
      "Nothing",
      "Whatever he can afford"
    ],
    "answer": "Nothing"
  },
  {
    "id": 45,
    "type": "situational",
    "article": 1800,
    "question": "M was appointed manager in the Articles of Partnership. Partners A and B don't like his decisions and want to remove him by majority vote. Can they?",
    "options": [
      "Yes, majority rules.",
      "No, his power is irrevocable without just cause.",
      "Yes, if they pay him.",
      "No, unless M agrees."
    ],
    "answer": "No, his power is irrevocable without just cause."
  },
  {
    "id": 46,
    "type": "situational",
    "article": 1801,
    "question": "Managers A and B have equal power. A wants to buy a truck. B opposes. Who wins?",
    "options": [
      "A, because he had the idea.",
      "B, because he objected.",
      "Majority of managers (if more exist) or partners with controlling interest.",
      "The court."
    ],
    "answer": "Majority of managers (if more exist) or partners with controlling interest."
  },
  {
    "id": 47,
    "type": "situational",
    "article": 1804,
    "question": "Partner P asks his friend F to help him with his partnership tasks and shares his own profits with F. Do the other partners need to accept F as a partner?",
    "options": [
      "Yes, F is working for the firm.",
      "No, F is only a sub-partner of P.",
      "Yes, if F invests money.",
      "No, unless F signs the contract."
    ],
    "answer": "No, F is only a sub-partner of P."
  },
  {
    "id": 48,
    "type": "situational",
    "article": 1807,
    "question": "Partner K uses partnership funds to buy a lot in his own name and sells it for a profit. Who owns the profit?",
    "options": [
      "Partner K.",
      "The Partnership.",
      "Split 50/50.",
      "The government."
    ],
    "answer": "The Partnership."
  },
  {
    "id": 49,
    "type": "situational",
    "article": 1808,
    "question": "The partnership sells shoes. Partner C (Capitalist) opens a shoe store next door. Is this allowed?",
    "options": [
      "Yes, it's a free country.",
      "No, capitalist partners cannot engage in the same business.",
      "Yes, if he is an industrial partner.",
      "No, unless he pays tax."
    ],
    "answer": "No, capitalist partners cannot engage in the same business."
  },
  {
    "id": 50,
    "type": "situational",
    "article": 1809,
    "question": "Partner J is kicked out of the office and not allowed to see the books. Can he demand a formal account?",
    "options": [
      "No, only at the end of the year.",
      "Yes, because he is wrongfully excluded.",
      "No, he must resign first.",
      "Yes, if he pays a fee."
    ],
    "answer": "Yes, because he is wrongfully excluded."
  },
  {
    "id": 51,
    "type": "situational",
    "article": 1788,
    "question": "Partner A took P10,000 from the partnership vault for a personal trip. When does his liability for interest begin?",
    "options": [
      "When the partners find out.",
      "When he returns.",
      "From the time he converted the amount to his own use.",
      "At the end of the year."
    ],
    "answer": "From the time he converted the amount to his own use."
  },
  {
    "id": 52,
    "type": "situational",
    "article": 1803,
    "question": "There is no agreement on management. Partner A buys supplies. Partner B refuses to pay. Is the partnership bound?",
    "options": [
      "No, B did not agree.",
      "Yes, every partner is an agent in the absence of agreement.",
      "No, A needs a power of attorney.",
      "Yes, but A pays half."
    ],
    "answer": "Yes, every partner is an agent in the absence of agreement."
  },
  {
    "id": 53,
    "type": "situational",
    "article": 1793,
    "question": "A, B, C are partners. D owes the firm P30k. A collects his P10k share. D goes bankrupt. Can B and C ask A to share his P10k?",
    "options": [
      "No, A was smart to collect early.",
      "Yes, Art 1793 requires A to bring it to the partnership capital.",
      "No, it's D's fault.",
      "Yes, but only 50%."
    ],
    "answer": "Yes, Art 1793 requires A to bring it to the partnership capital."
  },
  {
    "id": 54,
    "type": "situational",
    "article": 1779,
    "question": "In a universal partnership of all present property, Partner A inherits a house later. Does the house belong to the partnership?",
    "options": [
      "Yes, everything belongs to the partnership.",
      "No, future inheritance is not included.",
      "Yes, if A wants to.",
      "No, but the partnership gets the house title."
    ],
    "answer": "No, future inheritance is not included."
  },
  {
    "id": 55,
    "type": "situational",
    "article": 1779,
    "question": "Same scenario: A inherits a house. He rents it out. Does the RENT money belong to the partnership?",
    "options": [
      "No.",
      "Yes, fruits of future property are included if stipulated.",
      "Yes, always.",
      "No, never."
    ],
    "answer": "Yes, fruits of future property are included if stipulated."
  },
  {
    "id": 56,
    "type": "situational",
    "article": 1802,
    "question": "The contract says 'No one acts without consent of all.' Partner A sees the warehouse is on fire and hires a fire truck without asking B and C. Is this valid?",
    "options": [
      "No, he violated the contract.",
      "Yes, because of imminent danger of grave injury.",
      "No, he must call them first.",
      "Yes, if it's cheap."
    ],
    "answer": "Yes, because of imminent danger of grave injury."
  },
  {
    "id": 57,
    "type": "situational",
    "article": 1799,
    "question": "The contract states 'Partner A gets 100% of profits.' Is the partnership void?",
    "options": [
      "Yes, the whole contract is void.",
      "No, only the stipulation is void.",
      "Yes, unless A did all the work.",
      "No, it is valid."
    ],
    "answer": "No, only the stipulation is void."
  },
  {
    "id": 58,
    "type": "situational",
    "article": 1768,
    "question": "A, B, C form a partnership but hide their articles and keep it secret. They contract in their own names. Do they have juridical personality?",
    "options": [
      "Yes.",
      "No, they are governed by co-ownership.",
      "Yes, as a de facto corporation.",
      "Maybe."
    ],
    "answer": "No, they are governed by co-ownership."
  },
  {
    "id": 59,
    "type": "situational",
    "article": 1786,
    "question": "Partner A contributes a house. A stranger, Mr. X, wins a court case claiming he owns the house (eviction). Is Partner A liable?",
    "options": [
      "No, it's not his fault.",
      "Yes, a partner is bound for warranty in case of eviction.",
      "No, the partnership takes the risk.",
      "Yes, but only for half value."
    ],
    "answer": "Yes, a partner is bound for warranty in case of eviction."
  },
  {
    "id": 60,
    "type": "situational",
    "article": 1805,
    "question": "Partner B wants to photocopy the financial records at 2 PM on a Tuesday. The manager refuses, saying 'Trust me'. Can B insist?",
    "options": [
      "No, trust is key.",
      "Yes, partners have the right to inspect at reasonable hours.",
      "No, he needs a court order.",
      "Yes, but he must pay the manager."
    ],
    "answer": "Yes, partners have the right to inspect at reasonable hours."
  },
  {
    "id": 61,
    "type": "identification",
    "article": 1767,
    "question": "What is the term for a contract where two or more persons bind themselves to contribute money, property, or industry to a common fund, with the intention of dividing the profits among themselves?",
    "answer": "PARTNERSHIP"
  },
  {
    "id": 62,
    "type": "identification",
    "article": 1768,
    "question": "What does a partnership possess that is separate and distinct from that of each of the partners?",
    "answer": "JURIDICIAL PERSONALITY"
  },
  {
    "id": 63,
    "type": "identification",
    "article": 1776,
    "question": "What type of partnership is one where all the partners are liable pro rata with all their property and after all the partnership assets have been exhausted?",
    "answer": "GENERAL PARTNERSHIP"
  },
  {
    "id": 64,
    "type": "identification",
    "article": 1776,
    "question": "What type of partnership has at least one general partner and at least one limited partner?",
    "answer": "LIMITED PARTNERSHIP"
  },
  {
    "id": 65,
    "type": "identification",
    "article": 1785,
    "question": "What do you call a partnership that is formed for a specific piece of work or business project?",
    "answer": "PARTICULAR PARTNERSHIP"
  },
  {
    "id": 66,
    "type": "identification",
    "article": 1789,
    "question": "Which type of partner contributes only his skill, labor, or industry?",
    "answer": "INDUSTRIAL PARTNER"
  },
  {
    "id": 67,
    "type": "identification",
    "article": 1789,
    "question": "Which type of partner contributes money or property to the common fund?",
    "answer": "CAPITALIST PARTNER"
  },
  {
    "id": 68,
    "type": "identification",
    "article": 1796,
    "question": "What is the term for the obligation of the partnership to answer for the amounts a partner disbursed on its behalf?",
    "answer": "REIMBURSEMENT"
  },
  {
    "id": 69,
    "type": "identification",
    "article": 1800,
    "question": "If a manager is appointed in the Articles of Partnership, his power is ____________.",
    "answer": "IRREVOCABLE"
  },
  {
    "id": 70,
    "type": "identification",
    "article": 1799,
    "question": "What is the Latin term (or general term) for a void stipulation which excludes a partner from sharing in profits or losses?",
    "answer": "PACTUM LEONINA"
  },
  {
    "id": 71,
    "type": "identification",
    "article": 1767,
    "question": "Partnership is a ____________ contract because it is perfected by mere consent.",
    "answer": "CONSENSUAL"
  },
  {
    "id": 72,
    "type": "identification",
    "article": 1767,
    "question": "Partnership is a ____________ contract because the parties contribute to a common fund.",
    "answer": "ONEROUS"
  },
  {
    "id": 73,
    "type": "identification",
    "article": 1772,
    "question": "With which government agency must a partnership with P3,000 or more capital register?",
    "answer": "SEC"
  },
  {
    "id": 74,
    "type": "identification",
    "article": 1803,
    "question": "In the absence of a designated manager, every partner is considered an ____________ of the partnership.",
    "answer": "AGENT"
  },
  {
    "id": 75,
    "type": "identification",
    "article": 1767,
    "question": "This principle means that a partner has the right to choose who he wants to be partners with (Choice of Person).",
    "answer": "DELECTUS PERSONAE"
  },
  {
    "id": 76,
    "type": "identification",
    "article": 1773,
    "question": "If immovable property is contributed, what must be made, signed, and attached to the public instrument for the contract to be valid?",
    "answer": "INVENTORY"
  },
  {
    "id": 77,
    "type": "identification",
    "article": 1804,
    "question": "What do you call a person associated by a partner in his share?",
    "answer": "SUB-PARTNER"
  },
  {
    "id": 78,
    "type": "identification",
    "article": 1795,
    "question": "Who bears the risk of loss of fungible things contributed to the partnership?",
    "answer": "PARTNERSHIP"
  },
  {
    "id": 79,
    "type": "identification",
    "article": 1795,
    "question": "Who bears the risk of loss of specific, non-fungible things contributed to the partnership where only the *use* is contributed?",
    "answer": "PARTNER"
  },
  {
    "id": 80,
    "type": "identification",
    "article": 1807,
    "question": "A partner who makes a secret profit holds it as a ____________ for the partnership.",
    "answer": "TRUSTEE"
  },
  {
    "id": 81,
    "type": "identification",
    "article": 1786,
    "question": "A partner is liable for ____________ if he is evicted from the specific thing he contributed.",
    "answer": "WARRANTY"
  },
  {
    "id": 82,
    "type": "identification",
    "article": 1788,
    "question": "A partner who takes money from the partnership chest for his own use is liable for interest starting from the time of ____________.",
    "answer": "CONVERSION"
  },
  {
    "id": 83,
    "type": "identification",
    "article": 1791,
    "question": "An industrial partner is EXEMPT from the requirement to contribute additional capital in case of ____________.",
    "answer": "IMMINENT LOSS"
  },
  {
    "id": 84,
    "type": "identification",
    "article": 1792,
    "question": "If a managing partner collects a sum from a debtor who owes both him and the partnership, and he issues a partnership receipt, the payment applies to ____________.",
    "answer": "PARTNESHIP CREDIT"
  },
  {
    "id": 85,
    "type": "identification",
    "article": 1769,
    "question": "Receipt of a share of the profits is ____________ evidence that a person is a partner.",
    "answer": "PRIMA FACIE"
  },
  {
    "id": 86,
    "type": "identification",
    "article": 1780,
    "question": "A universal partnership of profits comprises all that the partners may acquire by their ____________.",
    "answer": "INDUSTRY"
  },
  {
    "id": 87,
    "type": "identification",
    "article": 1779,
    "question": "In a universal partnership of all present property, property acquired by inheritance is ____________ (Included/Excluded).",
    "answer": "EXCLUDED"
  },
  {
    "id": 88,
    "type": "identification",
    "article": 1805,
    "question": "Partners have the right to ____________ and copy partnership books.",
    "answer": "INSPECT"
  },
  {
    "id": 89,
    "type": "identification",
    "article": 1808,
    "question": "A capitalist partner cannot engage in a business that is of the same ____________ as the partnership business.",
    "answer": "KIND"
  },
  {
    "id": 90,
    "type": "identification",
    "article": 1809,
    "question": "A partner may demand a formal ____________ if he is wrongfully excluded from the partnership business.",
    "answer": "ACCOUNT"
  },
  {
    "id": 91,
    "type": "multiple_choice",
    "article": 1767,
    "question": "Which Article defines a partnership as a contract where two or more persons bind themselves to contribute money, property, or industry to a common fund, with the intention of dividing the profits among themselves?",
    "options": [
      "Article 1767",
      "Article 1768",
      "Article 1769",
      "Article 1770"
    ],
    "answer": "Article 1767"
  },
  {
    "id": 92,
    "type": "multiple_choice",
    "article": 1768,
    "question": "Which Article states that a partnership has a juridical personality separate and distinct from that of each of the partners?",
    "options": [
      "Article 1768",
      "Article 1767",
      "Article 1775",
      "Article 1780"
    ],
    "answer": "Article 1768"
  },
  {
    "id": 93,
    "type": "multiple_choice",
    "article": 1769,
    "question": "Which Article provides the rules to determine whether a partnership exists, including the rule that sharing gross returns does not of itself establish a partnership?",
    "options": [
      "Article 1769",
      "Article 1770",
      "Article 1771",
      "Article 1772"
    ],
    "answer": "Article 1769"
  },
  {
    "id": 94,
    "type": "identification",
    "article": 1770,
    "question": "Which Article states that a partnership must have a lawful object or purpose, and must be established for the common benefit or interest of the partners?",
    "answer": "ARTICLE 1770"
  },
  {
    "id": 95,
    "type": "identification",
    "article": 1771,
    "question": "Which Article provides that a partnership may be constituted in any form, except where immovable property or real rights are contributed thereto?",
    "answer": "ARTICLE 1771"
  },
  {
    "id": 96,
    "type": "multiple_choice",
    "article": 1772,
    "question": "Which Article requires that every partnership having a capital of three thousand pesos or more, in money or property, shall appear in a public instrument and be registered in the Securities and Exchange Commission?",
    "options": [
      "Article 1772",
      "Article 1773",
      "Article 1774",
      "Article 1775"
    ],
    "answer": "Article 1772"
  },
  {
    "id": 97,
    "type": "multiple_choice",
    "article": 1773,
    "question": "Which Article declares a contract of partnership void if immovable property is contributed and an inventory of said property is not made, signed by the parties, and attached to the public instrument?",
    "options": [
      "Article 1773",
      "Article 1772",
      "Article 1775",
      "Article 1776"
    ],
    "answer": "Article 1773"
  },
  {
    "id": 98,
    "type": "identification",
    "article": 1776,
    "question": "Which Article classifies partnerships as to their object (universal or particular) and as to the liability of the partners (general or limited)?",
    "answer": "ARTICLE 1776"
  },
  {
    "id": 99,
    "type": "identification",
    "article": 1778,
    "question": "Which Article defines a partnership of all present property as that in which the partners contribute all the property which actually belongs to them to a common fund?",
    "answer": "ARTICLE 1778"
  },
  {
    "id": 100,
    "type": "multiple_choice",
    "article": 1785,
    "question": "Which Article states that when a partnership for a fixed term is continued after the termination of such term without any express agreement, the rights and duties of the partners remain the same as they were at such termination?",
    "options": [
      "Article 1785",
      "Article 1786",
      "Article 1787",
      "Article 1788"
    ],
    "answer": "Article 1785"
  },
  {
    "id": 101,
    "type": "multiple_choice",
    "article": 1789,
    "question": "Which Article prohibits an industrial partner from engaging in business for himself unless the partnership expressly permits him to do so?",
    "options": [
      "Article 1789",
      "Article 1788",
      "Article 1790",
      "Article 1808"
    ],
    "answer": "Article 1789"
  },
  {
    "id": 102,
    "type": "identification",
    "article": 1791,
    "question": "Which Article obliges a partner to sell his interest to the other partners if he refuses to contribute an additional share to the capital in case of an imminent loss of the business?",
    "answer": "ARTICLE 1791"
  },
  {
    "id": 103,
    "type": "identification",
    "article": 1792,
    "question": "Which Article governs the application of payment when a managing partner collects a demandable sum from a person who owes both the partnership and the managing partner?",
    "answer": "ARTICLE 1792"
  },
  {
    "id": 104,
    "type": "multiple_choice",
    "article": 1795,
    "question": "Which Article determines who bears the risk of specific and determinate things which are not fungible contributed to the partnership so that only their use and fruits may be for the common benefit?",
    "options": [
      "Article 1795",
      "Article 1794",
      "Article 1796",
      "Article 1797"
    ],
    "answer": "Article 1795"
  },
  {
    "id": 105,
    "type": "multiple_choice",
    "article": 1797,
    "question": "Which Article provides the rules for the distribution of profits and losses among partners, including the rule for industrial partners?",
    "options": [
      "Article 1797",
      "Article 1796",
      "Article 1798",
      "Article 1799"
    ],
    "answer": "Article 1797"
  },
  {
    "id": 106,
    "type": "identification",
    "article": 1799,
    "question": "Which Article declares a stipulation which excludes one or more partners from any share in the profits or losses as void?",
    "answer": "ARTICLE 1799"
  },
  {
    "id": 107,
    "type": "identification",
    "article": 1800,
    "question": "Which Article states that the partner who has been appointed manager in the articles of partnership may execute all acts of administration despite the opposition of his partners, unless he should act in bad faith?",
    "answer": "ARTICLE 1800"
  },
  {
    "id": 108,
    "type": "multiple_choice",
    "article": 1804,
    "question": "Which Article allows every partner to associate another person with him in his share, but states that the associate shall not be admitted into the partnership without the consent of all the other partners?",
    "options": [
      "Article 1804",
      "Article 1803",
      "Article 1805",
      "Article 1806"
    ],
    "answer": "Article 1804"
  },
  {
    "id": 109,
    "type": "multiple_choice",
    "article": 1805,
    "question": "Which Article states that the partnership books shall be kept, subject to any agreement between the partners, at the principal place of business of the partnership?",
    "options": [
      "Article 1805",
      "Article 1804",
      "Article 1806",
      "Article 1807"
    ],
    "answer": "Article 1805"
  },
  {
    "id": 110,
    "type": "identification",
    "article": 1808,
    "question": "Which Article prohibits capitalist partners from engaging for their own account in any operation which is of the kind of business in which the partnership is engaged, unless there is a stipulation to the contrary?",
    "answer": "ARTICLE 1808"
  },
  {
    "id": 111,
    "type": "multiple_choice",
    "article": 1809,
    "question": "Which Article grants any partner the right to a formal account as to partnership affairs if he is wrongfully excluded from the partnership business?",
    "options": [
      "Article 1809",
      "Article 1808",
      "Article 1807",
      "Article 1806"
    ],
    "answer": "Article 1809"
  },
  {
    "id": 112,
    "type": "identification",
    "article": 1784,
    "question": "Which Article states that a partnership begins from the moment of the execution of the contract, unless it is otherwise stipulated?",
    "answer": "ARTICLE 1784"
  },
  {
    "id": 113,
    "type": "multiple_choice",
    "article": 1790,
    "question": "Which Article presumes that partners shall contribute equal shares to the capital of the partnership unless there is a stipulation to the contrary?",
    "options": [
      "Article 1790",
      "Article 1789",
      "Article 1791",
      "Article 1792"
    ],
    "answer": "Article 1790"
  },
  {
    "id": 114,
    "type": "identification",
    "article": 1793,
    "question": "Which Article requires a partner who has received his share of a partnership credit to bring to the partnership capital what he received if the debtor thereafter becomes insolvent?",
    "answer": "ARTICLE 1793"
  },
  {
    "id": 115,
    "type": "multiple_choice",
    "article": 1796,
    "question": "Which Article mandates that the partnership shall be responsible to every partner for the amounts he may have disbursed on behalf of the partnership?",
    "options": [
      "Article 1796",
      "Article 1795",
      "Article 1797",
      "Article 1798"
    ],
    "answer": "Article 1796"
  },
  {
    "id": 116,
    "type": "identification",
    "article": 1801,
    "question": "Which Article provides that if two or more partners have been entrusted with the management without specification of duties, each one may separately execute all acts of administration?",
    "answer": "ARTICLE 1801"
  },
  {
    "id": 117,
    "type": "multiple_choice",
    "article": 1803,
    "question": "Which Article applies when the manner of management has not been agreed upon, stating that all partners shall be considered agents?",
    "options": [
      "Article 1803",
      "Article 1802",
      "Article 1804",
      "Article 1805"
    ],
    "answer": "Article 1803"
  },
  {
    "id": 118,
    "type": "identification",
    "article": 1806,
    "question": "Which Article requires partners to render on demand true and full information of all things affecting the partnership to any partner or the legal representative of any deceased partner?",
    "answer": "ARTICLE 1806"
  },
  {
    "id": 119,
    "type": "multiple_choice",
    "article": 1807,
    "question": "Which Article states that every partner must account to the partnership for any benefit, and hold as trustee for it any profits derived by him without the consent of the other partners?",
    "options": [
      "Article 1807",
      "Article 1806",
      "Article 1808",
      "Article 1809"
    ],
    "answer": "Article 1807"
  },
  {
    "id": 120,
    "type": "identification",
    "article": 1802,
    "question": "Which Article stipulates that when it is agreed that none of the managing partners shall act without the consent of the others, the concurrence of all shall be necessary for the validity of the acts?",
    "answer": "ARTICLE 1802"
  }
];

        // --- GLOBAL VARIABLES ---
        let activeQuestions = [];
        let currentIndex = 0;
        let score = 0;
        let selectedAnswer = null;
        const STORAGE_KEY = 'rfbt_quiz_data';

        // --- TRUE RANDOM SHUFFLE (Fisher-Yates) ---
        function shuffle(array) {
            let currentIndex = array.length, randomIndex;
            while (currentIndex != 0) {
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex--;
                [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
            }
            return array;
        }

        // --- CLOCK FUNCTION ---
        function updateClock() {
            const now = new Date();
            // Time
            document.getElementById('clock-time').textContent = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit', second:'2-digit'});
            // Date
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('clock-date').textContent = now.toLocaleDateString(undefined, options);
        }
        setInterval(updateClock, 1000);
        updateClock(); // Initial call

        // --- THEME TOGGLE ---
        document.getElementById('themeToggle').addEventListener('click', () => {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-bs-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            
            html.setAttribute('data-bs-theme', newTheme);
            document.querySelector('.navbar').style.backgroundColor = newTheme === 'light' ? 'rgba(255,255,255,0.8)' : 'rgba(30,30,30,0.8)';
            
            const icon = document.querySelector('#themeToggle i');
            icon.className = newTheme === 'light' ? 'fas fa-moon' : 'fas fa-sun';
        });

        // --- START QUIZ ---
        document.getElementById('setup-form').addEventListener('submit', (e) => {
            e.preventDefault();
            
            // Get Values
            const type = document.getElementById('qType').value;
            const count = parseInt(document.querySelector('input[name="qCount"]:checked').value);
            const sArt = parseInt(document.getElementById('startArt').value);
            const eArt = parseInt(document.getElementById('endArt').value);

            // Filter Data
            let pool = quizData.filter(q => {
                const typeOk = type === 'mixed' ? true : q.type === type;
                const artOk = q.article ? (q.article >= sArt && q.article <= eArt) : true;
                return typeOk && artOk;
            });

            if (pool.length === 0) {
                const err = document.getElementById('error-box');
                err.textContent = "No questions found in this range/type.";
                err.classList.remove('hidden');
                return;
            }

            // Shuffle & Slice
            pool = shuffle(pool);
            activeQuestions = pool.slice(0, count);

            // Init Variables
            currentIndex = 0;
            score = 0;
            localStorage.removeItem(STORAGE_KEY); // Wipe old session
            localStorage.setItem(STORAGE_KEY, JSON.stringify([])); // Init new session

            // Change View
            document.getElementById('setup-view').classList.add('hidden');
            document.getElementById('quiz-view').classList.remove('hidden');
            renderQuestion();
        });

        // --- RENDER QUESTION ---
        function renderQuestion() {
            const q = activeQuestions[currentIndex];
            selectedAnswer = null;

            // Update UI Stats
            document.getElementById('curr-num').textContent = currentIndex + 1;
            document.getElementById('total-num').textContent = activeQuestions.length;
            document.getElementById('art-ref').textContent = `Art. ${q.article || 'Gen'}`;
            document.getElementById('progress-bar').style.width = `${(currentIndex / activeQuestions.length) * 100}%`;
            document.getElementById('type-badge').textContent = q.type.toUpperCase().replace('_', ' ');
            document.getElementById('q-text').textContent = q.question;

            const area = document.getElementById('options-area');
            area.innerHTML = '';

            if (q.type === 'identification') {
                // Text Input
                area.innerHTML = `
                    <div class="form-floating">
                        <input type="text" class="form-control fw-bold fs-5 text-uppercase" id="ident-input" placeholder="ANSWER" autocomplete="off">
                        <label>Type your answer here (AUTO-CAPS)</label>
                    </div>
                `;
                const inp = document.getElementById('ident-input');
                setTimeout(() => inp.focus(), 100);
                inp.addEventListener('input', (e) => {
                    e.target.value = e.target.value.toUpperCase();
                    selectedAnswer = e.target.value.trim();
                });
            } else {
                // Multiple Choice Buttons (Shuffled)
                let choices = [...q.options];
                choices = shuffle(choices);

                choices.forEach((opt, i) => {
                    const uniqueId = `opt-${i}`;
                    const safeOpt = opt.replace(/"/g, '&quot;');
                    area.innerHTML += `
                        <input type="radio" class="btn-check" name="opts" id="${uniqueId}" value="${safeOpt}">
                        <label class="btn btn-option" for="${uniqueId}">
                            ${opt}
                        </label>
                    `;
                });

                area.addEventListener('change', (e) => {
                    if(e.target.name === 'opts') selectedAnswer = e.target.value;
                });
            }
        }

        // --- NEXT BUTTON HANDLER ---
        function handleNext() {
            if (!selectedAnswer) return alert("Please answer the question!");

            const q = activeQuestions[currentIndex];
            const isCorrect = (selectedAnswer.trim().toUpperCase() === q.answer.trim().toUpperCase());
            
            if (isCorrect) score++;

            // Save Attempt to LocalStorage
            const attempt = {
                qNum: currentIndex + 1,
                question: q.question,
                type: q.type,
                article: q.article,
                userAns: selectedAnswer,
                correctAns: q.answer,
                isCorrect: isCorrect
            };
            
            const history = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
            history.push(attempt);
            localStorage.setItem(STORAGE_KEY, JSON.stringify(history));

            // Proceed
            currentIndex++;
            if (currentIndex < activeQuestions.length) {
                renderQuestion();
            } else {
                finishQuiz();
            }
        }

        // --- FINISH ---
        function finishQuiz() {
            document.getElementById('quiz-view').classList.add('hidden');
            document.getElementById('result-view').classList.remove('hidden');

            document.getElementById('final-score').textContent = score;
            document.getElementById('final-total').textContent = activeQuestions.length;

            const pct = (score / activeQuestions.length) * 100;
            const msgBox = document.getElementById('feedback-msg');
            
            if(pct >= 90) { 
                msgBox.textContent = "Excellent! You are ready.";
                msgBox.className = "alert alert-success fw-bold";
            } else if(pct >= 75) {
                msgBox.textContent = "Good job! Just a few mistakes.";
                msgBox.className = "alert alert-info fw-bold";
            } else {
                msgBox.textContent = "Review the answers below and try again.";
                msgBox.className = "alert alert-warning fw-bold";
            }
        }

        // --- REVIEW GENERATOR ---
        function toggleReviewSection() {
            const container = document.getElementById('review-container');
            const list = document.getElementById('review-list');
            
            if (container.classList.contains('hidden')) {
                // Fetch from Storage
                const history = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
                list.innerHTML = '';

                if (history.length === 0) {
                    list.innerHTML = '<p class="text-muted">No review data found.</p>';
                }

                history.forEach(att => {
                    const colorClass = att.isCorrect ? 'review-correct' : 'review-wrong';
                    const icon = att.isCorrect ? '<i class="fas fa-check-circle text-success"></i>' : '<i class="fas fa-times-circle text-danger"></i>';
                    
                    list.innerHTML += `
                        <div class="card p-3 ${colorClass} review-card">
                            <div class="d-flex justify-content-between text-muted small fw-bold mb-2">
                                <span>Q${att.qNum}  ${att.type.toUpperCase()}</span>
                                <span>Art. ${att.article || 'Gen'}</span>
                            </div>
                            <h5 class="mb-3 fw-bold">${att.question}</h5>
                            
                            <div class="mb-2">
                                <span class="small text-uppercase text-muted">Your Answer</span><br>
                                <span class="${att.isCorrect ? 'text-success' : 'text-danger'} fw-bold fs-5">
                                    ${att.userAns} ${icon}
                                </span>
                            </div>

                            ${!att.isCorrect ? `
                            <div class="mt-2 p-3 bg-white border rounded">
                                <span class="small text-uppercase text-muted d-block mb-1">Correct Answer</span>
                                <span class="text-success fw-bold fs-5">${att.correctAns}</span>
                            </div>
                            ` : ''}
                        </div>
                    `;
                });

                container.classList.remove('hidden');
                setTimeout(() => container.scrollIntoView({ behavior: 'smooth' }), 100);
            } else {
                container.classList.add('hidden');
            }
        }

        // --- RESET ---
        function resetQuiz() {
            localStorage.removeItem(STORAGE_KEY); // Wipe data
            location.reload(); // Refresh page
        }

        function confirmQuit() {
            if(confirm("Are you sure? Progress will be lost.")) {
                resetQuiz();
            }
        }
    </script>
</body>
</html>
